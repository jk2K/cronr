!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CronrCounter=t():e.CronrCounter=t()}(window,function(){return function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(2),{isLeap:r}=s.default;t.units=["milliSecond","second","minute","hour","day","month","weekday"];const o=[31,28,31,30,31,30,31,31,30,31,30,31],a=[31,29,31,30,31,30,31,31,30,31,30,31];let i=Object.create(null);const l=1e3;class u{constructor(e){const{unit:t,value:n,step:s,max:r,min:o,order:a,setCallee:i,affiliatedMax:l}=e;this.unit=t,this.value=n,this.max=r,this.min=o,this.order=a,this.step=s,this.setCallee=i,this.affiliatedMax=l}static instance(e){return u.create(e)}static create(e){return u.getInstance(e)}static getDayMax({month:e,year:t}){return r(t)?a[e]:o[e]}static getInstance(e){if(!i[e]){const n={unit:e,order:t.units.indexOf(e)+1};let s=void 0;switch(e){case"milliSecond":s={min:0,max:999,step:1,value:1,setCallee:"setMilliseconds"};break;case"second":s={min:0,max:59,step:1*l,value:1*l,setCallee:"setSeconds"};break;case"minute":s={min:0,max:59,step:60*l,value:60*l,setCallee:"setMinutes"};break;case"hour":s={min:0,max:23,step:3600*l,value:3600*l,setCallee:"setHours"};break;case"day":s={min:1,max:u.getDayMax,step:86400*l,value:86400*l,setCallee:"setDate"};break;case"weekday":s={min:1,max:7,affiliatedMax:u.getDayMax,step:86400*l,value:void 0,setCallee:"setDate"};break;case"month":s={min:0,max:11,step:86400*l,value:void 0,setCallee:"setMonth"}}i[e]=new u(Object.assign({},s,n))}return i[e]}}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e=>({milliSecond:e.getMilliseconds(),second:e.getSeconds(),minute:e.getMinutes(),hour:e.getHours(),day:e.getDate(),month:e.getMonth(),weekday:0===e.getDay()?7:e.getDay()}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(8),r=n(7),o=n(6),a=n(5),i=n(1);t.default={min:s.default,toNum:a.default,isLeap:r.default,sortByValue:o.default,resolveTsParts:i.default}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LITERAL="literal",t.RANGE="range",t.EVERY="every"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(0),o=e=>"number"==typeof e,a=e=>d.indexOf(e),i=e=>f.indexOf(e),l=e=>parseInt(e),u=e=>e.charAt(0).toUpperCase()+e.toLowerCase().slice(1,3),c=e=>e.replace(/[a-zA-Z]+/g,u),d=[,"Mon","Tue","Wed","Thu","Fri","Sat","Sun"],f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function h(e){return t=>{for(let n of e){if(n.test(t))return j[n.source](t)}throw new Error("no match patterns")}}const p=e=>t=>e.reduce((e,t)=>t(e),t),m=Object.create(null);m.month=p([c,e=>e.replace(/[0-9]+/g,e=>`${parseInt(e)-1}`)]),m.weekday=p([c]);const y=/^(\d{1,2})$/,v=/^(\d{1,2})$/,T=/^(\d+)-(\d+)$/,k=/^(\*)(?:\/([0-9]*))?$/,b=/^(\d{1,2})\/([0-9]*)$/,O=/^(\d+)-(\d+)\/([0-9]*)$/,g=RegExp(`^(${d.join("|")})(?:-(${d.join("|")}))?$`),x=RegExp(`^(${f.join("|")})(?:-(${f.join("|")}))?$`),w=Object.create(null);w.milliSecond=h([v,T,k,O]),w.second=h([y,T,k,O]),w.minute=h([y,T,k,O]),w.hour=h([y,T,k,O]),w.day=h([y,T,k,O]),w.month=h([y,T,k,O,x]),w.weekday=h([y,T,k,O,g]);const j=Object.create(null),E=e=>e.source;j[E(y)]=(e=>{const t=y.exec(e);if(t){const[,e]=t;return{type:s.LITERAL,value:l(e)}}return null}),j[E(v)]=(e=>{const t=v.exec(e);if(t){const[,e]=t;return{type:s.LITERAL,value:l(e)}}return null}),j[E(T)]=(e=>{const t=T.exec(e);if(t){const[,e,n]=t;return{type:s.RANGE,value:{from:l(e),to:l(n)}}}return null}),j[E(k)]=(e=>{const t=k.exec(e);if(t){const[,,e]=t;return e?{type:s.EVERY,value:l(e)}:{type:s.EVERY,value:1}}}),j[E(b)]=(e=>{const t=b.exec(e);if(t){const[,e,n]=t;return[{type:s.EVERY,value:l(n)},{type:s.RANGE,value:{from:l(e)}}]}}),j[E(O)]=(e=>{const t=O.exec(e);if(t){const[,e,n,r]=t;return[{type:s.EVERY,value:l(r)},{type:s.RANGE,value:{from:l(e),to:l(n)}}]}return[]}),j[E(g)]=(e=>{const t=c(e),n=g.exec(t);if(n){const[,e,t]=n;return t?{type:s.RANGE,value:{from:a(e),to:a(t)}}:{type:s.LITERAL,value:a(e)}}}),j[E(x)]=(e=>{const t=c(e),n=x.exec(t);if(n){const[,e,t]=n;return t?{type:s.RANGE,value:{from:i(e),to:i(t)}}:{type:s.LITERAL,value:i(e)}}});const C=(e,t,n)=>n>e?e:n<t?t:n,M=e=>t=>{const n=r.default.getInstance(e),{max:a,min:i}=n;return o(a)&&o(i)?t.map(e=>{switch(e.type){case s.LITERAL:return Object.assign({},e,{value:C(a,i,e.value)});case s.RANGE:return Object.assign({},e,{value:((e,t,n)=>{const{from:s,to:r}=n;return{from:C(e,t,s),to:C(e,t,r)}})(a,i,e.value)});case s.EVERY:return Object.assign({},e)}}):t},V=Object.create(null);V.milliSecond=p([M("milliSecond")]),V.second=p([M("second")]),V.minute=p([M("minute")]),V.hour=p([M("hour")]),V.month=p([M("month")]),V.weekday=p([e=>e.map(e=>{switch(e.type){case s.LITERAL:const t=e.value;return Object.assign({},e,{value:0===t?7:t});case s.RANGE:const n=e.value;return 0===n.from&&6===n.to?Object.assign({},e,{value:{from:1,to:7}}):Object.assign({},e);case s.EVERY:return Object.assign({},e)}}),M("weekday")]),t.parse=function(e,t){return e.split(",").reduce((e,n)=>{const s=w[t];let r=n;m[t]&&(r=m[t](n));let o=s(r);return V[t]&&(o=V[t]([].concat(o))),e.concat(o)},[])}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=(e=>e.valueOf())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=((e,t)=>{const{value:n}=e,{value:s}=t;return n-s})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e=>!(!(e%4)||e%100||e%400))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=(e=>e.reduce((e,t)=>t?void 0!==e?Math.min(e,t):t:e))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),r=n(3),o=n(2),a=n(1),i=n(4),{toNum:l}=o.default;class u{constructor(e,t){this.pattern=e,this.unit=t}static create(e,t){return new u(e,t)}resolvedOptions(){return this.resolvedOptionsCache||(this.resolvedOptionsCache=s.default.instance(this.unit)),this.resolvedOptionsCache}matchToken(e,t){const n=this.formatToParts(),s=n.filter(e=>e.type===r.LITERAL),o=n.filter(e=>e.type===r.EVERY);let a=n.filter(e=>e.type===r.RANGE);for(let t of s){const{value:n}=t;if(n===e)return!0}let i=1;o.length>0&&(i=o[0].value);const{min:l,max:u}=this.resolvedOptions();let c=u;"function"==typeof u&&t&&(c=u(t)),0===a.length&&o.length>0&&(a=[{type:r.RANGE,value:{from:l,to:c}}]);for(let t of a){const n=t.value.from||l,s=t.value.to||c;for(let t=n;t<=s;t+=i)if(e===t)return!0}return!1}findTheClosestValidValue(e,t){const{max:n,min:s}=this.resolvedOptions(),r=a.default(t);let o=n;if("function"==typeof o){t.getFullYear(),t.getMonth();o=o(r)}for(let t=e;t>=s&&t<=o;t++)if(this.matchToken(t,r))return t;throw new Error("Maybe you should carry over the number, then match again")}findTheClosestValidValueForWeekday(e,t){const{affiliatedMax:n,min:s}=this.resolvedOptions(),r=a.default(t),o=new Date(l(t));if(!n)return;t.getFullYear(),t.getMonth();const i=n(r);for(let t=e;t>=s&&t<=i;){const{weekday:e}=a.default(o);if(this.matchToken(e,r))return t;t++,o.setDate(t)}throw new Error("Maybe you should carry over the number, then match again")}formatToParts(){return this.formatToPartsCache||(this.formatToPartsCache=i.parse(this.pattern,this.unit)),this.formatToPartsCache}}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(9),r=n(0),o=Symbol("millisecond_base"),a=Symbol("second_based"),i=Symbol("minute_base");class l{constructor(e){this.milliSecondToken=Object.create(null),this.secondToken=Object.create(null),this.minuteToken=Object.create(null),this.hourToken=Object.create(null),this.dayToken=Object.create(null),this.monthToken=Object.create(null),this.weekdayToken=Object.create(null),this.pattern=e,this.type=o}static create(e){const t=new l(e);return t.initToken(),t}patternParts(){return this.pattern.split(" ")}resolveStep(){const e=this.fullPatternParts.length;let t=0;for(;t<e&&"*"===this.fullPatternParts[t];t++);if(t!==e){return this[`${r.units[t]}Token`].resolvedOptions().step}switch(this.type){case o:return 1;case a:return 1e3;case i:return 6e4;default:return 1}}initToken(){let e=this.patternParts();const t=e.length;if(t<5||t>7)throw new Error("Invalid pattern");5===t&&(e=["*","*"].concat(e),this.type=i),6===t&&(e=["*"].concat(e),this.type=a),this.fullPatternParts=e,e.forEach((e,t)=>this[`${r.units[t]}Token`]=s.default.create(e,r.units[t]))}}t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(10),r=n(2),o=n(0),a=n(1),{min:i,toNum:l}=r.default;t.default=class{constructor(e){const{pattern:t,ts:n}=e,r=s.default.create(t),{milliSecondToken:o,secondToken:a,minuteToken:i,hourToken:u,dayToken:c,monthToken:d,weekdayToken:f}=r;this.pattern=r,this.milliSecondToken=o,this.secondToken=a,this.minuteToken=i,this.hourToken=u,this.dayToken=c,this.monthToken=d,this.weekdayToken=f,this.originTs=n||new Date,this.ts=new Date(l(this.originTs)),this.nextTs=void 0}[Symbol.iterator](){return{next:()=>{this.prevTs=new Date(l(this.ts));const e=this.nextTimeToCall(),t=this.pattern.resolveStep();return this.ts=new Date(l(e)+t),{value:e,done:!1}}}}nextTimeToCall(){const e=o.units.length;return this.traverse(o.units[e-2],this.ts),this.ts}normalizeTsValueAfterUnit(e,t,n){const s=o.units.indexOf(e);let r=s;n&&(r=s+1);for(let e=0;e<r;e++){const n=o.units[e],s=this.getTokenByUnit(n).resolvedOptions(),{setCallee:r,min:a}=s;t[r](a)}}decorateTsWithClosestValidValueAfterUnit(e,t,n){const s=o.units.indexOf(e);let r=s;n&&(r=s+1);for(let e=0;e<r;e++){const n=o.units[e],s=this.getTokenByUnit(n),r=a.default(t)[n],i=s.findTheClosestValidValue(r,t),l=s.resolvedOptions(),{setCallee:u}=l;t[u](i)}}traverse(e,t){const n=o.units.indexOf(e),s=this.getTokenByUnit(e),r=a.default(t),i=r[e];if(!this.checkIfTokenMatchsValue(s,i,r))try{const a=this.findTokenClosestValidValue(s,i,t),{setCallee:l}=s.resolvedOptions();return t[l](a),this.normalizeTsValueAfterUnit(e,t),void this.decorateTsWithClosestValidValueAfterUnit(e,t)}catch(s){if("month"!==e){const e=o.units[n+1],s=this.getTokenByUnit(e),{setCallee:a}=s.resolvedOptions(),i=r[e];t[a](i+1),this.normalizeTsValueAfterUnit(e,t),this.traverse(e,t)}else{const n=t.getFullYear();t.setFullYear(n+1),this.normalizeTsValueAfterUnit(e,t,!0),this.decorateTsWithClosestValidValueAfterUnit(e,t,!0)}return}n>0&&this.traverse(o.units[n-1],t)}checkIfTokenMatchsValue(e,t,n){if("day"!==e.unit)return e.matchToken(t,n);const s=this.getTokenByUnit("weekday"),r=e.pattern,o=s.pattern;if("*"===o&&"*"===r)return!0;const a=e.matchToken(t,n),i=s.matchToken(n.weekday,n);return"*"===o&&"*"!==r?a:"*"!==o&&"*"===r?i:a||i}findTokenClosestValidValue(e,t,n){if("day"!==e.unit)return e.findTheClosestValidValue(t,n);const s=a.default(n),r=this.getTokenByUnit("weekday"),o=e.pattern,i=r.pattern;if("*"===i&&"*"===o)return t;e.matchToken(t,s),r.matchToken(s.weekday,s);let l=void 0,u=void 0;try{l=e.findTheClosestValidValue(t,n)}catch(e){if("*"===i&&"*"!==o)throw e}if("*"===i&&"*"!==o)return l;try{u=r.findTheClosestValidValueForWeekday(t,n)}catch(e){if("*"!==i&&"*"===o)throw e}if("*"!==i&&"*"===o)return u;if(l&&u)return Math.min(l,u);throw new Error("Carry over to fetch again")}getTokenByUnit(e){return this[`${e}Token`]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(11);t.default=class{constructor(e){const{name:t,pattern:n,ts:r}=e;this.name=t,this.resolver=new s.default({pattern:n,ts:r}),this.result=this.resolver[Symbol.iterator]()}}}])});