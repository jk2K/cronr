!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CronrWorker=e():t.CronrWorker=e()}(window,function(){return function(t){var e={};function s(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=2)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=(()=>{const t=t=>!(!(t%4)||t%100||t%400),e=t=>({milliSecond:t.getMilliseconds(),second:t.getSeconds(),minute:t.getMinutes(),hour:t.getHours(),day:t.getDate(),month:t.getMonth(),weekday:0===t.getDay()?7:t.getDay()}),s=t=>t.valueOf(),n="literal",r="range",a="every",i=t=>"number"==typeof t,o=t=>d.indexOf(t),c=t=>f.indexOf(t),l=t=>parseInt(t),u=t=>t.charAt(0).toUpperCase()+t.toLowerCase().slice(1,3),h=t=>t.replace(/[a-zA-Z]+/g,u),d=[,"Mon","Tue","Wed","Thu","Fri","Sat","Sun"],f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function m(t){return e=>{for(let s of t){if(s.test(e))return j[s.source](e)}throw new Error("no match patterns")}}const p=t=>e=>t.reduce((t,e)=>e(t),e),y=Object.create(null);y.month=p([h,t=>t.replace(/[0-9]+/g,t=>`${parseInt(t)-1}`)]),y.weekday=p([h]);const T=/^(\d{1,2})$/,v=/^(\d{1,2})$/,k=/^(\d+)-(\d+)$/,g=/^(\*)(?:\/([0-9]*))?$/,w=/^(\d{1,2})\/([0-9]*)$/,b=/^(\d+)-(\d+)\/([0-9]*)$/,x=RegExp(`^(${d.join("|")})(?:-(${d.join("|")}))?$`),O=RegExp(`^(${f.join("|")})(?:-(${f.join("|")}))?$`),C=Object.create(null);C.milliSecond=m([v,k,g,b]),C.second=m([T,k,g,b]),C.minute=m([T,k,g,b]),C.hour=m([T,k,g,b]),C.day=m([T,k,g,b]),C.month=m([T,k,g,b,O]),C.weekday=m([T,k,g,b,x]);const j=Object.create(null),M=t=>t.source;j[M(T)]=(t=>{const e=T.exec(t);if(e){const[,t]=e;return{type:n,value:l(t)}}return null}),j[M(v)]=(t=>{const e=v.exec(t);if(e){const[,t]=e;return{type:n,value:l(t)}}return null}),j[M(k)]=(t=>{const e=k.exec(t);if(e){const[,t,s]=e;return{type:r,value:{from:l(t),to:l(s)}}}return null}),j[M(g)]=(t=>{const e=g.exec(t);if(e){const[,,t]=e;return t?{type:a,value:l(t)}:{type:a,value:1}}}),j[M(w)]=(t=>{const e=w.exec(t);if(e){const[,t,s]=e;return[{type:a,value:l(s)},{type:r,value:{from:l(t)}}]}}),j[M(b)]=(t=>{const e=b.exec(t);if(e){const[,t,s,n]=e;return[{type:a,value:l(n)},{type:r,value:{from:l(t),to:l(s)}}]}return[]}),j[M(x)]=(t=>{const e=h(t),s=x.exec(e);if(s){const[,t,e]=s;return e?{type:r,value:{from:o(t),to:o(e)}}:{type:n,value:o(t)}}}),j[M(O)]=(t=>{const e=h(t),s=O.exec(e);if(s){const[,t,e]=s;return e?{type:r,value:{from:c(t),to:c(e)}}:{type:n,value:c(t)}}});const V=(t,e,s)=>s>t?t:s<e?e:s,S=t=>e=>{const s=_.getInstance(t),{max:o,min:c}=s;return i(o)&&i(c)?e.map(t=>{switch(t.type){case n:return Object.assign({},t,{value:V(o,c,t.value)});case r:return Object.assign({},t,{value:((t,e,s)=>{const{from:n,to:r}=s;return{from:V(t,e,n),to:V(t,e,r)}})(o,c,t.value)});case a:return Object.assign({},t)}}):e},D=Object.create(null);D.milliSecond=p([S("milliSecond")]),D.second=p([S("second")]),D.minute=p([S("minute")]),D.hour=p([S("hour")]),D.month=p([S("month")]),D.weekday=p([t=>t.map(t=>{switch(t.type){case n:const e=t.value;return Object.assign({},t,{value:0===e?7:e});case r:const s=t.value;return 0===s.from&&6===s.to?Object.assign({},t,{value:{from:1,to:7}}):Object.assign({},t);case a:return Object.assign({},t)}}),S("weekday")]);const P=["milliSecond","second","minute","hour","day","month","weekday"],$=[31,28,31,30,31,30,31,31,30,31,30,31],U=[31,29,31,30,31,30,31,31,30,31,30,31];let A=Object.create(null);const E=1e3;class _{constructor(t){const{unit:e,value:s,step:n,max:r,min:a,order:i,setCallee:o,affiliatedMax:c}=t;this.unit=e,this.value=s,this.max=r,this.min=a,this.order=i,this.step=n,this.setCallee=o,this.affiliatedMax=c}static instance(t){return _.create(t)}static create(t){return _.getInstance(t)}static getDayMax({month:e,year:s}){return t(s)?U[e]:$[e]}static getInstance(t){if(!A[t]){const e={unit:t,order:P.indexOf(t)+1};let s=void 0;switch(t){case"milliSecond":s={min:0,max:999,step:1,value:1,setCallee:"setMilliseconds"};break;case"second":s={min:0,max:59,step:1*E,value:1*E,setCallee:"setSeconds"};break;case"minute":s={min:0,max:59,step:60*E,value:60*E,setCallee:"setMinutes"};break;case"hour":s={min:0,max:23,step:3600*E,value:3600*E,setCallee:"setHours"};break;case"day":s={min:1,max:_.getDayMax,step:86400*E,value:86400*E,setCallee:"setDate"};break;case"weekday":s={min:1,max:7,affiliatedMax:_.getDayMax,step:86400*E,value:void 0,setCallee:"setDate"};break;case"month":s={min:0,max:11,step:86400*E,value:void 0,setCallee:"setMonth"}}A[t]=new _(Object.assign({},s,e))}return A[t]}}class I{constructor(t,e){this.pattern=t,this.unit=e}static create(t,e){return new I(t,e)}resolvedOptions(){return this.resolvedOptionsCache||(this.resolvedOptionsCache=_.instance(this.unit)),this.resolvedOptionsCache}matchToken(t,e){const s=this.formatToParts(),i=s.filter(t=>t.type===n),o=s.filter(t=>t.type===a);let c=s.filter(t=>t.type===r);for(let e of i){const{value:s}=e;if(s===t)return!0}let l=1;o.length>0&&(l=o[0].value);const{min:u,max:h}=this.resolvedOptions();let d=h;"function"==typeof h&&e&&(d=h(e)),0===c.length&&o.length>0&&(c=[{type:r,value:{from:u,to:d}}]);for(let e of c){const s=e.value.from||u,n=e.value.to||d;for(let e=s;e<=n;e+=l)if(t===e)return!0}return!1}findTheClosestValidValue(t,s){const{max:n,min:r}=this.resolvedOptions(),a=e(s);let i=n;if("function"==typeof i){s.getFullYear(),s.getMonth();i=i(a)}for(let e=t;e>=r&&e<=i;e++)if(this.matchToken(e,a))return e;throw new Error("Maybe you should carry over the number, then match again")}findTheClosestValidValueForWeekday(t,n){const{affiliatedMax:r,min:a}=this.resolvedOptions(),i=e(n),o=new Date(s(n));if(!r)return;n.getFullYear(),n.getMonth();const c=r(i);for(let s=t;s>=a&&s<=c;){const{weekday:t}=e(o);if(this.matchToken(t,i))return s;s++,o.setDate(s)}throw new Error("Maybe you should carry over the number, then match again")}formatToParts(){var t,e;return this.formatToPartsCache||(this.formatToPartsCache=(t=this.pattern,e=this.unit,t.split(",").reduce((t,s)=>{const n=C[e];let r=s;y[e]&&(r=y[e](s));let a=n(r);return D[e]&&(a=D[e]([].concat(a))),t.concat(a)},[]))),this.formatToPartsCache}}const W=Symbol("millisecond_base"),B=Symbol("second_based"),F=Symbol("minute_base");class z{constructor(t){this.milliSecondToken=Object.create(null),this.secondToken=Object.create(null),this.minuteToken=Object.create(null),this.hourToken=Object.create(null),this.dayToken=Object.create(null),this.monthToken=Object.create(null),this.weekdayToken=Object.create(null),this.pattern=t,this.type=W}static create(t){const e=new z(t);return e.initToken(),e}patternParts(){return this.pattern.split(" ")}resolveStep(){const t=this.fullPatternParts.length;let e=0;for(;e<t&&"*"===this.fullPatternParts[e];e++);if(e!==t){return this[`${P[e]}Token`].resolvedOptions().step}switch(this.type){case W:return 1;case B:return 1e3;case F:return 6e4;default:return 1}}initToken(){let t=this.patternParts();const e=t.length;if(e<5||e>7)throw new Error("Invalid pattern");5===e&&(t=["*","*"].concat(t),this.type=F),6===e&&(t=["*"].concat(t),this.type=B),this.fullPatternParts=t,t.forEach((t,e)=>this[`${P[e]}Token`]=I.create(t,P[e]))}}class N{constructor(t){const{pattern:e,ts:n}=t,r=z.create(e),{milliSecondToken:a,secondToken:i,minuteToken:o,hourToken:c,dayToken:l,monthToken:u,weekdayToken:h}=r;this.pattern=r,this.milliSecondToken=a,this.secondToken=i,this.minuteToken=o,this.hourToken=c,this.dayToken=l,this.monthToken=u,this.weekdayToken=h,this.originTs=n||new Date,this.ts=new Date(s(this.originTs)),this.nextTs=void 0}[Symbol.iterator](){return{next:()=>{this.prevTs=new Date(s(this.ts));const t=this.nextTimeToCall(),e=this.pattern.resolveStep();return this.ts=new Date(s(t)+e),{value:t,done:!1}}}}nextTimeToCall(){const t=P.length;return this.traverse(P[t-2],this.ts),this.ts}normalizeTsValueAfterUnit(t,e,s){const n=P.indexOf(t);let r=n;s&&(r=n+1);for(let t=0;t<r;t++){const s=P[t],n=this.getTokenByUnit(s).resolvedOptions(),{setCallee:r,min:a}=n;e[r](a)}}decorateTsWithClosestValidValueAfterUnit(t,s,n){const r=P.indexOf(t);let a=r;n&&(a=r+1);for(let t=0;t<a;t++){const n=P[t],r=this.getTokenByUnit(n),a=e(s)[n],i=r.findTheClosestValidValue(a,s),o=r.resolvedOptions(),{setCallee:c}=o;s[c](i)}}traverse(t,s){const n=P.indexOf(t),r=this.getTokenByUnit(t),a=e(s),i=a[t];if(!this.checkIfTokenMatchsValue(r,i,a))try{const e=this.findTokenClosestValidValue(r,i,s),{setCallee:o}=r.resolvedOptions();return s[o](e),this.normalizeTsValueAfterUnit(t,s),void this.decorateTsWithClosestValidValueAfterUnit(t,s)}catch(e){if("month"!==t){const t=P[n+1],e=this.getTokenByUnit(t),{setCallee:r}=e.resolvedOptions(),i=a[t];s[r](i+1),this.normalizeTsValueAfterUnit(t,s),this.traverse(t,s)}else{const e=s.getFullYear();s.setFullYear(e+1),this.normalizeTsValueAfterUnit(t,s,!0),this.decorateTsWithClosestValidValueAfterUnit(t,s,!0)}return}n>0&&this.traverse(P[n-1],s)}checkIfTokenMatchsValue(t,e,s){if("day"!==t.unit)return t.matchToken(e,s);const n=this.getTokenByUnit("weekday"),r=t.pattern,a=n.pattern;if("*"===a&&"*"===r)return!0;const i=t.matchToken(e,s),o=n.matchToken(s.weekday,s);return"*"===a&&"*"!==r?i:"*"!==a&&"*"===r?o:i||o}findTokenClosestValidValue(t,s,n){if("day"!==t.unit)return t.findTheClosestValidValue(s,n);const r=e(n),a=this.getTokenByUnit("weekday"),i=t.pattern,o=a.pattern;if("*"===o&&"*"===i)return s;t.matchToken(s,r),a.matchToken(r.weekday,r);let c=void 0,l=void 0;try{c=t.findTheClosestValidValue(s,n)}catch(t){if("*"===o&&"*"!==i)throw t}if("*"===o&&"*"!==i)return c;try{l=a.findTheClosestValidValueForWeekday(s,n)}catch(t){if("*"!==o&&"*"===i)throw t}if("*"!==o&&"*"===i)return l;if(c&&l)return Math.min(c,l);throw new Error("Carry over to fetch again")}getTokenByUnit(t){return this[`${t}Token`]}}return class{constructor(t,e,s={immediate:!1,startTime:new Date}){this.pattern=t,this.cb=e;const{startTime:n,immediate:r}=s;this.counter=new class{constructor(t){const{name:e,pattern:s,ts:n}=t;this.name=e,this.resolver=new N({pattern:s,ts:n}),this.result=this.resolver[Symbol.iterator]()}}({pattern:this.pattern,ts:n}),this.iterator=this.counter.result,this.immediate=r,this.status="initial",this.endTime=s.endTime}resolveNextValidAction(t){switch(t){case"initial":return["start"];case"running":return["stop","clear"];case"suspend":return["clear","resume"];case"clear":return["restart"]}}start(t){if("initial"!==this.status)throw new Error(this.msg(this.status));!t&&this.immediate&&this.cb.call(null);const e=new Date;let n=this.iterator.next().value;for(;n<e;)n=this.iterator.next().value;let r=s(n)-s(e);0===r&&this.immediate&&(n=this.iterator.next().value,r=s(n)-s(e)),this.nextTick=n;const a=()=>{const t=this.iterator.next().value;if(!this.endTime||this.endTime>t){const e=s(t)-s(new Date);this.nextTick=t,this.timeoutId=setTimeout(a,e)}this.cb.call(this)};this.timeoutId=setTimeout(a,r),this.status="running"}msg(t){return`Current status is '${t}', `+`you can only do ${JSON.stringify(this.resolveNextValidAction(t))} action`}stop(){if("running"!==this.status)throw new Error(this.msg(this.status));clearTimeout(this.timeoutId),this.status="suspend"}clear(){if("running"!==this.status&&"suspend"!==this.status)throw new Error(this.msg(this.status));clearTimeout(this.timeoutId),this.status="clear"}restart(){if("clear"!==this.status)throw new Error(this.msg(this.status));this.status="initial",this.start()}resume(){if("suspend"!==this.status)throw new Error(this.msg(this.status));this.status="initial",this.start(!0)}}})},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){let s=void 0;const n=e();let r=0;addEventListener("message",e=>{const{action:a}=e.data;switch(a){case"start":(s=new n(t,()=>{postMessage({action:"trigger",triggerAt:new Date,nextTick:s.nextTick,hit:++r,status:s.status})})).start();break;case"stop":s.stop(),postMessage({action:"updateStatus",status:s.status});break;case"resume":s.resume(),postMessage({action:"updateStatus",status:s.status});break;case"clear":s.clear(),postMessage({action:"updateStatus",status:s.status});break;case"restart":s.restart(),postMessage({action:"updateStatus",status:s.status});break;case"terminate":close();break;case"queryNextTick":postMessage(s.nextTick)}})}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=s(1),r=s(0);e.default=(t=>new Worker(window.URL.createObjectURL(new Blob(["("+n.default+')("'+t+'", '+r.default+")"]))))}])});